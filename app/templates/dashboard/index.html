{% extends 'base.html' %}
{% block content %}
<h3>Dashboard</h3>
<div class="card mb-3">
  <div class="card-header">Statistics</div>
  <div class="card-body">
    <div class="row">
      <div class="col-md-3">
        <h5>{{ stats.total }}</h5>
        <p>Total Postings</p>
      </div>
      <div class="col-md-3">
        <h5>{{ stats.sent }}</h5>
        <p>Successful</p>
      </div>
      <div class="col-md-3">
        <h5>{{ stats.errors }}</h5>
        <p>Errors</p>
      </div>
      <div class="col-md-3">
        <h5>{{ stats.last_week }}</h5>
        <p>Last 7 Days</p>
      </div>
    </div>
  </div>
</div>

<div class="card mb-3">
  <div class="card-body">
    <p><strong>Gmail:</strong> {{ 'set' if settings and settings.gmail_address else 'not set' }}</p>
    <p><strong>Telegram:</strong> {{ 'set' if settings and (settings.telegram_channel_username or settings.telegram_channel_id) else 'not set' }}</p>
    <p><strong>OpenAI:</strong> {{ 'set' if settings and settings.openai_api_key_encrypted else 'not set' }}</p>
    <p><strong>Auto-posting:</strong> {{ 'enabled' if settings and settings.auto_post_enabled else 'disabled' }}</p>
    <a class="btn btn-sm btn-secondary" href="/settings/posting">Edit Posting Settings</a>
  </div>
</div>

<h5>Recent logs</h5>
<table class="table table-sm">
  <thead><tr><th>When</th><th>Title</th><th>Sent</th><th>Error</th></tr></thead>
  <tbody>
  {% for l in logs %}
    <tr>
      <td>{{ l.created_at }}</td>
      <td>{{ l.car_title or l.subject }}</td>
      <td>{{ 'yes' if l.sent_to_channel else 'no' }}</td>
      <td>{{ l.error[:80] if l.error }}</td>
    </tr>
  {% endfor %}
  </tbody>
</table>

{% if pagination %}
<nav aria-label="Logs pagination">
  <ul class="pagination">
    {% if pagination.has_prev %}
      <li class="page-item"><a class="page-link" href="{{ url_for('dashboard.index', page=pagination.prev_num) }}">Previous</a></li>
    {% else %}
      <li class="page-item disabled"><span class="page-link">Previous</span></li>
    {% endif %}
    
    {% for page_num in pagination.iter_pages() %}
      {% if page_num %}
        {% if page_num == pagination.page %}
          <li class="page-item active"><span class="page-link">{{ page_num }}</span></li>
        {% else %}
          <li class="page-item"><a class="page-link" href="{{ url_for('dashboard.index', page=page_num) }}">{{ page_num }}</a></li>
        {% endif %}
      {% else %}
        <li class="page-item disabled"><span class="page-link">...</span></li>
      {% endif %}
    {% endfor %}
    
    {% if pagination.has_next %}
      <li class="page-item"><a class="page-link" href="{{ url_for('dashboard.index', page=pagination.next_num) }}">Next</a></li>
    {% else %}
      <li class="page-item disabled"><span class="page-link">Next</span></li>
    {% endif %}
  </ul>
</nav>
{% endif %}

{% endblock %}
